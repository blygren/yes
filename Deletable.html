<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebRTC P2P Video Call</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; line-height: 1.6; padding: 20px; max-width: 800px; margin: 0 auto; background-color: #f4f4f4; color: #333; }
        h1, h2 { color: #111; }
        .container { display: flex; justify-content: space-between; flex-wrap: wrap; }
        .video-wrapper { width: 100%; max-width: 360px; margin-bottom: 20px; }
        video { width: 100%; border-radius: 8px; background-color: #000; }
        .controls { background-color: #fff; padding: 20px; border-radius: 8px; margin-top: 20px; }
        textarea { width: 100%; height: 100px; margin-top: 5px; margin-bottom: 10px; border-radius: 4px; border: 1px solid #ccc; padding: 8px; box-sizing: border-box; }
        button { background-color: #007bff; color: white; border: none; padding: 10px 15px; border-radius: 4px; cursor: pointer; font-size: 16px; margin-right: 10px; margin-top: 5px; }
        button:disabled { background-color: #ccc; cursor: not-allowed; }
        button:hover:not(:disabled) { background-color: #0056b3; }
        hr { border: 0; height: 1px; background-color: #ddd; margin: 20px 0; }
        p { margin-top: 0; }
    </style>
</head>
<body>

    <h1>WebRTC P2P Video Call</h1>
    <p>A simple peer-to-peer video call with no server. You'll need to exchange connection details manually with your friend (e.g., via a chat app).</p>

    <div class="container">
        <div class="video-wrapper">
            <h2>You</h2>
            <video id="localVideo" autoplay muted playsinline></video>
        </div>
        <div class="video-wrapper">
            <h2>Friend</h2>
            <video id="remoteVideo" autoplay playsinline></video>
        </div>
    </div>

    <div class="controls">
        <button id="startButton">1. Start Camera</button>
        <hr>
        
        <h2>For Caller</h2>
        <p>Click to generate an offer and send it to your friend.</p>
        <button id="createOfferButton" disabled>2. Create Offer</button>
        <textarea id="offerSdp" readonly placeholder="Offer will appear here..."></textarea>
        <p>Paste the answer from your friend below and add it.</p>
        <textarea id="answerSdp" placeholder="Paste answer here..."></textarea>
        <button id="addAnswerButton" disabled>4. Add Answer</button>

        <hr>

        <h2>For Receiver</h2>
        <p>Paste the offer from your friend below.</p>
        <textarea id="offerToReceive" placeholder="Paste offer here..."></textarea>
        <button id="createAnswerButton" disabled>3. Create Answer</button>
        <p>Send the generated answer back to the caller.</p>
        <textarea id="answerSdpResponse" readonly placeholder="Answer will appear here..."></textarea>
    </div>

    <script>
        const startButton = document.getElementById('startButton');
        const createOfferButton = document.getElementById('createOfferButton');
        const createAnswerButton = document.getElementById('createAnswerButton');
        const addAnswerButton = document.getElementById('addAnswerButton');
        
        const offerSdp = document.getElementById('offerSdp');
        const answerSdp = document.getElementById('answerSdp');
        const offerToReceive = document.getElementById('offerToReceive');
        const answerSdpResponse = document.getElementById('answerSdpResponse');

        const localVideo = document.getElementById('localVideo');
        const remoteVideo = document.getElementById('remoteVideo');

        let localStream;
        let peerConnection;
        const config = {
            iceServers: [{ urls: 'stun:stun.l.google.com:19302' }]
        };

        async function start() {
            try {
                localStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
                localVideo.srcObject = localStream;
                
                startButton.disabled = true;
                createOfferButton.disabled = false;
                createAnswerButton.disabled = false;
            } catch (error) {
                console.error('Error accessing media devices.', error);
            }
        }

        function createPeerConnection() {
            peerConnection = new RTCPeerConnection(config);
            peerConnection.onicecandidate = event => {
                if (event.candidate) {
                    // This event fires multiple times, but we'll just wait for the final description
                } else {
                    // All ICE candidates have been gathered
                    const sdp = JSON.stringify(peerConnection.localDescription);
                    if (peerConnection.localDescription.type === 'offer') {
                        offerSdp.value = sdp;
                    } else {
                        answerSdpResponse.value = sdp;
                    }
                }
            };
            peerConnection.ontrack = event => {
                remoteVideo.srcObject = event.streams[0];
            };
            localStream.getTracks().forEach(track => {
                peerConnection.addTrack(track, localStream);
            });
        }

        async function createOffer() {
            createPeerConnection();
            const offer = await peerConnection.createOffer();
            await peerConnection.setLocalDescription(offer);
            createOfferButton.disabled = true;
            addAnswerButton.disabled = false;
        }

        async function createAnswer() {
            if (!offerToReceive.value) {
                alert('Please paste the offer from the caller first.');
                return;
            }
            createPeerConnection();
            const offer = JSON.parse(offerToReceive.value);
            await peerConnection.setRemoteDescription(new RTCSessionDescription(offer));
            const answer = await peerConnection.createAnswer();
            await peerConnection.setLocalDescription(answer);
            createAnswerButton.disabled = true;
        }

        async function addAnswer() {
            if (!answerSdp.value) {
                alert('Please paste the answer from the receiver first.');
                return;
            }
            const answer = JSON.parse(answerSdp.value);
            if (!peerConnection.currentRemoteDescription) {
                await peerConnection.setRemoteDescription(new RTCSessionDescription(answer));
            }
            addAnswerButton.disabled = true;
        }

        startButton.onclick = start;
        createOfferButton.onclick = createOffer;
        createAnswerButton.onclick = createAnswer;
        addAnswerButton.onclick = addAnswer;
    </script>

</body>
</html>
